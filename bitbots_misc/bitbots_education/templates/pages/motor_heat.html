{% import "components/imu.html" as imu_components %}
{% import "components/textbox.html" as components %}

<script type="text/javascript" >

  // Subscribing to a Topic
  // ----------------------

  var diagnostics_listener = new ROSLIB.Topic({
    ros : ros,
    name : '/diagnostics_agg',
    messageType : 'diagnostic_msgs/msg/DiagnosticArray'
  });

  diagnostics_listener.subscribe(function(message)
  {
    let output_string = "";
    let head_pen = 0.0;
    let head_tilt = 0.0;
    let camera = 0.0;

    let l_ancle_pitch = 0.0;
    let l_ancle_roll = 0.0;

    let l_hip_pitch = 0.0;
    let l_hip_roll = 0.0;
    let l_hip_yaw = 0.0;

    let l_knee = 0.0;

    let l_shoulder_pitch = 0.0;
    let l_shoulder_roll = 0.0;

    let r_ancle_pitch = 0.0;
    let r_ancle_roll = 0.0;

    let r_hip_pitch = 0.0;
    let r_hip_roll = 0.0;
    let r_hip_yaw = 0.0;

    let r_knee = 0.0;

    let r_shoulder_pitch = 0.0;
    let r_shoulder_roll = 0.0;
    
    for(let i = 0; i < message.status.length; i++)
    {
        if (message.status[i].name === "/Robot/Camera/")
        {
            camera = message.status[i].values[1].value
        }
        else if (message.status[i].name === "/Robot/Servos/HeadPan")
        {
            head_pen = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/HeadTilt")
        {
            head_tilt = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/LAnklePitch")
        {
            l_ancle_pitch = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/LAnkleRoll")
        {
            l_ancle_roll = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/LHipPitch")
        {
            l_hip_pitch = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/LHipRoll")
        {
            l_hip_roll = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/LHipYaw")
        {
            l_hip_yaw = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/LKnee")
        {
            l_knee = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/LShoulderPitch")
        {
            l_shoulder_pitch = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/LShoulderRoll")
        {
            l_shoulder_roll = message.status[i].values[2].value
        }
         else if (message.status[i].name === "/Robot/Servos/RAnklePitch")
        {
            r_ancle_pitch = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/RAnkleRoll")
        {
            r_ancle_roll = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/RHipPitch")
        {
            r_hip_pitch = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/RHipRoll")
        {
            r_hip_roll = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/RHipYaw")
        {
            r_hip_yaw = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/RKnee")
        {
            r_knee = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/RShoulderPitch")
        {
            r_shoulder_pitch = message.status[i].values[2].value
        }
        else if (message.status[i].name === "/Robot/Servos/RShoulderRoll")
        {
            r_shoulder_roll = message.status[i].values[2].value
        }
    }
    

    let head_temperature = Math.max(head_pen,head_tilt);
    output_string += `<div class="absolute top-[28%] left-[50%] w-8 h-8 bg-red-500 rounded-full blur-xs opacity-${head_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>`

    let camera_temperature = camera;
    output_string += `<div class="absolute top-[12%] left-[50%] w-8 h-8 bg-red-500 rounded-full blur opacity-${camera_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>`
    
    r_hip_temperature = Math.max(r_hip_pitch,r_hip_roll,r_hip_yaw);
    let r_knee_temperature = r_knee
    let r_ankle_temperature = Math.max(r_ancle_pitch,r_ancle_roll);
    console.log(r_hip_temperature);
    output_string += `
    <div class="absolute top-[56%] left-[65%] w-8 h-8 bg-red-500 rounded-full blur-xs opacity-${r_hip_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>
    <div class="absolute top-[71%] left-[66%] w-8 h-8 bg-red-500 rounded-full blur-xs opacity-${r_knee_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>
    <div class="absolute top-[93%] left-[67%] w-8 h-8 bg-red-500 rounded-full blur-xs  opacity-${r_ankle_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>`
   
    let l_hip_temperature = Math.max(l_hip_pitch,l_hip_roll,l_hip_yaw);
    let l_knee_temperature = l_knee;
    let l_ankle_temperature = Math.max(l_ancle_pitch,l_ancle_roll);
    output_string += `
    <div class="absolute top-[56%] left-[35%] w-8 h-8 bg-red-500 rounded-full blur-xs opacity-${l_hip_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div> 
    <div class="absolute top-[71%] left-[33%] w-8 h-8 bg-red-500 rounded-full blur-xs opacity-${l_knee_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>
    <div class="absolute top-[93%] left-[33%] w-8 h-8 bg-red-500 rounded-full blur-xs opacity-${l_ankle_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>`
    
    let r_shoulder_temperature = Math.max(r_shoulder_pitch,r_shoulder_roll);
    output_string += ` <div class="absolute top-[35%] left-[81%] w-8 h-8 bg-red-500 rounded-full blur-xs opacity-${r_shoulder_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>`
    
    let l_shoulder_temperature = Math.max(l_shoulder_pitch,l_shoulder_roll);
    output_string += ` <div class="absolute top-[35%] left-[19%] w-8 h-8 bg-red-500 rounded-full blur-xs opacity-${l_shoulder_temperature/80 * 100} pointer-events-none transform -translate-x-1/2 -translate-y-1/2"></div>`
    let element = document.getElementById("temperature_points");
    if (element === null)
  {
    imu_listener.unsubscribe();
    return;
  }
    document.getElementById("temperature_points").innerHTML = output_string;
   
  });

</script>

<h1 id="banner" hx-swap-oob="innerHTML">Motor Heat</h1>

<div class="flex justify-center flex-col bg-sky-1">

    <div class="p-6 overflow-hidden bg-sky-100 grid place-items-center">
        <div class="relative w-full" style="width: 60%;">
            <img src="assets/abstract_robot.svg" class="w-full">
            <div id="temperature_points"></div>
        </div>
    </div>

    {{ components.textbox("Explanation Text", "An Inertial Measurement Unit, or IMU, is an essential sensor commonly used in robotics to measure a robot’s orientation, velocity, and acceleration. It typically combines multiple sensing elements—most commonly accelerometers, gyroscopes, and sometimes magnetometers—to provide real-time data about the robot’s motion and position in three-dimensional space.", true) }}
    {{ components.textbox("Comparison to humans", "The IMU is like the sense of balance in humans", true)}}
    {{ components.textbox("Accerelometer", "The accelerometer in an IMU detects linear acceleration along the X, Y, and Z axes, helping the robot sense movements such as tilting, sudden changes in speed, or falls. The gyroscope measures angular velocity, or how quickly the robot is rotating around each axis, which is crucial for maintaining balance and stable orientation during motion. In some cases, a magnetometer is included to measure magnetic fields, allowing the robot to determine its heading relative to the Earth's magnetic north, similar to how a digital compass works.", true)}}
    {{ components.textbox("IMU in robotics", "IMUs are widely used in robots for navigation and localization, especially in environments where GPS signals are unavailable or unreliable. By tracking changes in orientation and motion, an IMU helps a robot understand how it has moved relative to its previous position. Robots that rely on dynamic balance, such as humanoid robots or drones, use IMU data to continuously adjust their posture and maintain stability. IMUs also support precise motion tracking, making them valuable in applications where robotic arms, wheels, or legs need to move with accuracy and control. Often, IMU data is combined with information from other sensors such as cameras or LiDAR in a process called sensor fusion, which enhances the robot’s understanding of its environment and improves navigation performance.", false)}}
    {{ components.textbox("Advantage of IMUs", "The main advantages of IMUs include their compact size, lightweight design, low power consumption, and ability to deliver real-time motion data. However, they are not without limitations. One common issue is drift, especially with gyroscopes, where small errors accumulate over time and can lead to incorrect position or orientation readings. Additionally, magnetometers can be affected by external magnetic interference, reducing the accuracy of heading measurements.", false)}}
    {{ components.textbox("Bringing it all together", "In summary, IMUs play a fundamental role in modern robotics by enabling robots to perceive and react to their motion and orientation. When integrated effectively, they significantly enhance a robot’s ability to move, navigate, and interact with the physical world.", false)}}
    
</div>
  



